using System;
using System.Diagnostics;
using System.Threading;
using System.Windows.Forms;
using Eplan.EplApi.ApplicationFramework;
using Eplan.EplApi.Base;
using Eplan.EplApi.Scripting;
class Program
{
    [Start]
    public void Action()
    {
        // Get selected pages
        var pages = GetPages();
        // Setup progressbar
        Progress progress = new Progress("EnhancedProgress");
        progress.SetTitle("Do Something with pages");
        progress.SetAllowCancel(true);
        progress.ShowImmediately();
        progress.SetNeededSteps(pages.Length + 1);
        try
        {
            // Do something with pages
            foreach (var page in pages)
            {
                progress.SetActionText(page);
                progress.Step(1);
                SelectPage();
               
            }
        }
        catch (Exception exception)
        {
            MessageBox.Show(exception.Message, "Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
        }
        finally
        {
            progress.EndPart(true);
        }
    }
    private static string[] GetPages()
    {
        ActionCallingContext actionCallingContext = new ActionCallingContext();
        string pagesString = string.Empty;
        actionCallingContext.AddParameter("TYPE", "PAGES");
        new CommandLineInterpreter().Execute("selectionset", actionCallingContext);
        actionCallingContext.GetParameter("PAGES", ref pagesString);
        string[] pages = pagesString.Split(';');
        return pages;
    }
    private void SelectPage()
    {
        ActionCallingContext acc = new ActionCallingContext();
        acc.AddParameter("PropertyId", "11006");
        
        new CommandLineInterpreter().Execute("XEsGetPagePropertyAction", acc);

        string propertyValue = "";
        acc.GetParameter("PropertyValue", ref propertyValue);

        MessageBox.Show("Valor de la propiedad 11006: " + propertyValue);
        propertyValue = "";
    }
}
//using (var qm = new QuietModeStep(QuietModes.ShowNoDialogs))
//{
//    new CommandLineInterpreter().Execute("XPmExternalDeletePages");
//}









